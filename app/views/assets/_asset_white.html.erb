<%= cache( logged_in? ? "asset#{asset.cache_key}/#{theme_name}" : "guest_asset#{asset.cache_key}/#{theme_name}" ) do %>
  <div class="asset_top">
    <div class="play-button button" data-target="normal-playback.play" data-action="click->normal-playback#togglePlay">
        <%= link_to user_track_path(asset.user.login, asset.permalink, format: :mp3),
          id: "play-#{asset.unique_id}", class: 'play_link', title: 'play' do %>
            <svg data-target="normal-playback.playButton" class="playIconSymbol" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 600 600">
            <path d="M187,489.21l-.31-378.41a.77.77,0,0,1,1.15-.67l150.53,86.75L515.71,299.08a.76.76,0,0,1,0,1.31L188.14,489.87A.76.76,0,0,1,187,489.21Z" />
            </svg>
        <% end %>
    </div>

    <div class="title" data-target="normal-playback.title" data-action="click->normal-playback#toggleDetails">
      <div class="title_left_column">
        <div class="title_left_column_top">
          <a href="<%= user_track_path(asset.user, asset.permalink) %>" class="track_link" title="<%= asset.name %>">
            <%= track_name_for(asset,200) %> <span style="font-size:12px;"><%= '&#x1f512;'.html_safe unless asset.published? %></span>             
          </a>
        </div>  
        <div class="title_left_column_bottom">
          <%= link_to asset.user.name, user_home_path(asset.user), :class => 'artist', :title => "#{asset.user.name} on alonetone " %>
        </div>
      </div>

      <div class="title_right_column">
        <div class='counter'></div>
        <div class='time' data-target="normal-playback.time"><%= asset.length %></div>
      </div>
    </div>
  </div>

  <div data-target="normal-playback.seekBarContainer" class="seekbar">
    <div data-target="normal-playback.seekBarLoaded" data-action="click->normal-playback#seek" class="loaded" style="width: 0%">
      <div data-target="normal-playback.seekBarPlayed" class="played" style="width: 0%"></div>
    </div>
  </div>

  <div class="tracks_reveal" data-target="asset.details">
    <a class="add_to_favorites" href="<%= toggle_favorite_path(:asset_id => asset.id) %>"></a>
    <div class="tracks_reveal_top">
      <div class='alonetoner'>
          <%= link_to(image_tag(avatar_or_placeholder_for(asset.user)), user_home_path(asset.user)) %>
      </div>
      <div class="description">
          <div class='user_description'>
            <%= awesome_truncate_with_read_more(asset, 250) %>
          </div>

          <div class="below_description">
            <div class="created"><%= local_time_ago(asset.created_at) %></div>
            <div class="plays"><%= asset.listens_count %> PLAYS</div>
            <%= link_to user_track_path(asset.user, asset.permalink), :title => "#{asset.name} by #{asset.user.name}" do %>
              <span>View more&hellip;</span>
            <% end unless @single_track %>
          </div>
          

      </div>
    </div>
  	<% if logged_in? || asset.guest_can_comment? %>
      <div id="comment_track_<%= asset.unique_id %>" class="comment_track">
      <div id="comment_<%= asset.unique_id %>" class="comment_asset" data-controller="comment">
        <div class="comment_form">
          <%= form_with url: user_track_comments_path(asset.user, asset), 
            id: "comment_form_#{asset.unique_id}", data: { action: 'ajax:beforeSend->comment#spin' } do |f| %>
          
          <div class="comment_as" data-target="comment.personalization">
              <!-- will be replaced by js payload to allow caching -->
          </div>
          
          <%= f.text_area :body, :rows =>4, :class=> 'double_trouble', :id=>"comment_body_#{asset.unique_id}"  %>

          <span class="private hidden" data-target="comment.banner">
            Only <span class="only_user_name"><%= asset.user.name%></span> and <span class="only_alonetone_mods">alonetone mods</span> will see this
          </span>

          <div class="private_check_box">
            <%= f.check_box :private, :class => 'private', 
              id: "checkbox_#{asset.unique_id}", data: { target: 'comment.checkbox', action: 'comment#toggle'}  %> 
              <label for="checkbox_<%= asset.unique_id %>"><span class="public">Make Private</span></label>
          </div>
          
          <%= f.hidden_field :commentable_type, :value => 'Asset', :id=> "comment_commentable_type_#{asset.unique_id}"%>
          <%= f.hidden_field :commentable_id, :value => asset.id, :id=> "comment_commentable_type_#{asset.unique_id}"%>

          <div class="submit_wrapper submit_wrapper_comment">
              <div class="comment_waiting" >
                <div class="text"><!-- placeholder response text --></div>
              </div>
              <div class="small_spinner" style="display:none;"></div>
              <%= f.submit "post comment".html_safe, :class => 'comment_submit',:id => "submit_#{asset.unique_id}"%> 
            </div>
          <% end %>  
        </div>
      </div>

      </div>
  	<% end %>
    <div class="track_links">
      <%= link_to edit_user_track_path(asset.user, asset), :class => 'show_to_admin_or_owner edit_in_box', :title => 'edit this track' do %>
        <span>edit</span>
      <% end %>

	    <% if !asset.private? %>
        <%= link_to 'mark as spam', spam_user_track_path(asset.user, asset), :class => 'show_to_admin_or_owner edit_in_box', :data => {:confirm => 'Are you sure you want to mark this as SPAM? This will make it harder for the user who posted this  to post again'}, :method => :put%>
      <% else %>
        <%= link_to 'unspam', unspam_user_track_path(asset.user, asset), :class => 'show_to_admin_or_owner edit_in_box', :data => {:confirm => 'This will publish this track!'}, :method => :put%>
      <% end %>

    </div>
  </div>
<% end %>
